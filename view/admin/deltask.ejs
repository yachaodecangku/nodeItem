<%include ../header.ejs%>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <% include nav.ejs%>
        <div class="layui-body">
            <!-- 内容主体区域 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                <legend>文章管理</legend>
            </fieldset>

            <table id="demo" class="layui-hide" lay-filter="demo"></table>
            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除文章</a>
            </script>

        </div>

        <div class="layui-footer">
            <!-- 底部固定区域 -->
            Super Administrator  &nbsp;&nbsp;&nbsp;&nbsp; 318112599@qq.com --yc
        </div>
    </div>
    <script src="../src/layui.js"></script>

    <script>
        //JavaScript代码区域
        layui.use(['element',"table","form"], function(){
            var table = layui.table;
            var $     = layui.$;
            var form = layui.form;

            table.render({
                elem:"#demo",
                url:"/api/task/all",
                method:"post",
                cols:[
                    [
                        {field:"title",title:"标题"},
                        {field:"author",title:"作者",templet:function (d) {
                                return d.author.username
                            }},
                        {field:"time",title:"发布时间",templet:function (d) {
                               return new Date(d.time).toLocaleString()
                        }},
                        {field:"difficulty",title:"难度"},
                        {field:"date",title:"截止日期"},
                        {field:"reward",title:"主题"},
                        // {field:"level",width:320,title:"级别"},
                        {toolbar:"#barDemo",title:"是否删除"}
                    ]
                ] ,page: true
            })
            table.on(("tool(demo)"),function (obj) {
                layer.confirm('你好好想想你在做什么', {icon: 3, title:'提示'}, function(index){
                    $.ajax({
                        url:"/api/task/del",
                        method:"post",
                        data:{
                            _id:obj.data._id
                        },
                    })
                    obj.del()

                    layer.close(index);
                });
                
            })});
    </script>
</body>
</html>












