<% include header.ejs %>
<style>
    .footer{
        position: absolute;
        width:100%;
        height:50px;

        bottom:0;
        left:0;
    }
    .footer a{
        display: block;
        font-size: 16px;
        color:#8D8D8D;
        margin:auto;
        text-align: center;
        line-height: 50px;
    }
</style>
</head>
<body>
    <div class="layui-bg-blue">
        <div class = "layui-header layui-main">
          <ul class="layui-nav layui-bg-blue">
        <li class="layui-nav-item layui-this"><a href="/" style="color:#fff;">文章吧</a></li>

    </ul>
            <ul class="layui-nav layui-bg-blue layui-layout-right " style="margin-right:-170px">
                <% if (login){ %>
                    <li class="layui-nav-item">当前用户: <%- user.username %></li>

                    <% if (user.level >= 1) { %>
                        <li class="layui-nav-item"><a href="/admin/task/add">后台管理</a></li>
                    <% } %>

                    <li class="layui-nav-item"><a href="/logout">退出</a></li>
                <% } else { %>
                    <li class="layui-nav-item"><a href="/login">登陆</a></li>
                    <li class="layui-nav-item"><a href="/reg">注册</a></li>
                <% } %>
            </ul>
        </div>
    </div>

     <div id="buts">
         <button class="layui-btn layui-btn-normal" data-yc="all">全部任务</button>
         <button class="layui-btn layui-btn-normal" data-yc="can">可以接取</button>
         <button class="layui-btn layui-btn-normal" data-yc="notcan">不可接取</button>
         <div style="float: right;">
             <% if (login) { %>
                 <% if (user.level >= 1){ %>
                     <button class="layui-btn layui-btn-normal" data-yc="my">我的发布</button>
                 <% } %>
                 <button class="layui-btn layui-btn-normal" data-yc="ing">已经接取</button>
                 <button class="layui-btn layui-btn-normal" data-yc="fin">已经完成</button>
             <% } %>
         </div>
     </div>
    <table class="layui-hide" lay-filter="demo" id="test"></table>
    <script type="text/html" id="xq">
        <a class="layui-btn layui-btn-xs" lay-event="aa">查看详情</a>
    </script>
    <div class="footer">
        <a href="http://www.miitbeian.gov.cn" >©2018-2019 zuasoftware.club  版权所有 ICP证:豫ICP备19004448号</a>

    </div>

    <script>
        //注意：导航 依赖 element 模块，否则无法进行功能性操作
        layui.use(['element', 'table', 'util'], function(){
            var element = layui.element;
            var util = layui.util;

            var table = layui.table;
             var  $ = layui.$;

            table.render({
                elem: '#test',
                url: '/api/task/all',
                method: 'post',
                cols: [
                    [{field:"title",title:"标题"},
                        {field:"author",title:"作者",templet:function (d) {
                                return d.author.username
                            }},
                        {field:"time",title:"发布时间",templet:function (d) {
                                return new Date(d.time).toLocaleString()
                            }},
                        {field:"difficulty",title:"难度"},
                        {field:"date",title:"截止日期"},
                        {field:"reward",title:"主题"},
                        // {field:"level",width:320,title:"级别"},
                        {toolbar: '#xq'}

                    ],
                ]
                ,page: true
            });
            table.on('tool(demo)', function (obj) {
                location.href = '/xq/' + obj.data._id;
            })

            var m = {
                all: function () {
                    table.reload('test', {
                        url: '/api/task/all'
                    })
                },
                can: function () {
                    table.reload('test', {
                        url: '/api/task/can'
                    })
                },
                notcan: function () {
                    table.reload('test', {
                        url: '/api/task/notcan'
                    })
                },
                my: function () {
                    table.reload('test', {
                        url: '/api/task/my'
                    })
                },
                ing: function () {
                    table.reload('test', {
                        url: '/api/task/ing'
                    })
                },
                fin: function () {
                    table.reload('test', {
                        url: '/api/task/fin'
                    })
                }

                }


            $('#buts .layui-btn').on('click', function () {
                console.dir(this);
                m[this.dataset.yc]()
            })


        });
    </script>

</body>
</html>














